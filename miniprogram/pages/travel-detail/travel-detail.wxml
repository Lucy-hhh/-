<!--pages/travel-detail/travel-detail.wxml-->
<view class="container" wx:if="{{route}}">
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <view class="nav-bar">
    <view class="nav-back" bindtap="goBack">
      <text class="back-icon">â†</text>
    </view>
    <text class="nav-title">ä¸€æ—¥æ¸¸è·¯çº¿</text>
    <view class="nav-placeholder"></view>
  </view>

  <!-- è·¯çº¿ç­›é€‰ Tab æ  -->
  <view class="tab-bar">
    <view class="tab-item {{routeId === '1' ? 'active' : ''}}" bindtap="loadRoute" data-id="1">å—æµ”å°„ä¸­æ‘</view>
    <view class="tab-item {{routeId === '2' ? 'active' : ''}}" bindtap="loadRoute" data-id="2">é’ç”°é¾™ç°æ‘</view>
    <view class="tab-item {{routeId === '3' ? 'active' : ''}}" bindtap="loadRoute" data-id="3">ä»™å±…æ¨å²¸æ‘</view>
  </view>

  <!-- è·¯çº¿æ€»è§ˆå¡ç‰‡ -->
  <view class="route-card">
    <view class="route-header">
      <view class="route-image"></view>
      <text class="route-badge">ä¸€æ—¥æ¸¸</text>
    </view>
    <view class="route-content">
      <text class="route-title">{{route.title}}</text>
      <view class="route-tags">
        <text class="tag" wx:for="{{route.tags}}" wx:key="index">{{item}}</text>
      </view>
      <view class="route-info">
        <text class="info-item">ğŸ“ {{route.location}}</text>
        <text class="info-item">â± {{route.duration}}</text>
      </view>
      <view class="route-price-info">
        <view class="price-left">
          <text class="price-main">ï¿¥{{route.adultPrice}}/äºº</text>
          <text class="price-child">å„¿ç«¥ ï¿¥{{route.childPrice}}/äºº</text>
        </view>
        <view class="price-right">
          <text class="sold-count">å·²å”® {{route.sold}}</text>
          <text class="sold-status">{{route.status}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æ—¶é—´è½´è¡Œç¨‹ç»„ä»¶ -->
  <view class="schedule-section">
    <view class="timeline-container">
      <view class="timeline-line"></view>
      <view class="timeline-content">
        <view class="schedule-item" wx:for="{{route.schedule}}" wx:key="index">
          <view class="timeline-dot"></view>
          <text class="schedule-time">{{item.time}}</text>
          <text class="schedule-title">{{item.title}}</text>
          <text class="schedule-desc">{{item.desc}}</text>
          <view class="schedule-tip">
            <text class="tip-icon">ğŸ’¡</text>
            <text class="tip-text">{{item.tip}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-bar">
    <button class="order-btn" bindtap="showPricePanel">ç«‹å³ä¸‹å•</button>
  </view>

  <!-- ä»·æ ¼é¢æ¿ -->
  <view class="price-panel {{showPricePanel ? 'open' : ''}}" wx:if="{{showPricePanel}}">
    <view class="panel-header">
      <text class="panel-title">é€‰æ‹©äººæ•°</text>
      <view class="panel-close" bindtap="closePricePanel">
        <text>âœ•</text>
      </view>
    </view>

    <!-- äººæ•°é€‰æ‹©å™¨ -->
    <view class="count-selector">
      <!-- æˆäººé€‰æ‹© -->
      <view class="count-item">
        <view class="count-info">
          <text class="count-label">æˆäºº</text>
          <text class="count-price">ï¿¥{{route.adultPrice}}/äºº</text>
        </view>
        <view class="count-controls">
          <button class="count-btn" bindtap="decreaseAdult" disabled="{{adultCount <= 1}}">-</button>
          <text class="count-value">{{adultCount}}</text>
          <button class="count-btn" bindtap="increaseAdult">+</button>
        </view>
      </view>

      <!-- å„¿ç«¥é€‰æ‹© -->
      <view class="count-item">
        <view class="count-info">
          <text class="count-label">å„¿ç«¥ (3-12å²)</text>
          <text class="count-price">ï¿¥{{route.childPrice}}/äºº Â· 3å²ä»¥ä¸‹å…è´¹</text>
        </view>
        <view class="count-controls">
          <button class="count-btn" bindtap="decreaseChild" disabled="{{childCount <= 0}}">-</button>
          <text class="count-value">{{childCount}}</text>
          <button class="count-btn" bindtap="increaseChild">+</button>
        </view>
      </view>
    </view>

    <!-- ä»·æ ¼æ˜ç»† -->
    <view class="price-details">
      <text class="details-title">è´¹ç”¨æ˜ç»†</text>
      <view class="details-list">
        <view class="detail-item" wx:for="{{route.priceDetails}}" wx:key="index">
          <text class="detail-name">{{item.name}}</text>
          <text class="detail-price">ï¿¥{{item.price}}</text>
        </view>
        <view class="detail-total">
          <text class="total-label">å°è®¡</text>
          <text class="total-price">ï¿¥{{route.adultPrice}}</text>
        </view>
      </view>
    </view>

    <!-- æ€»ä»·å’Œä¸‹å•æŒ‰é’® -->
    <view class="price-footer">
      <view class="total-section">
        <text class="total-label-small">æ€»è®¡</text>
        <text class="total-price-large">ï¿¥{{totalPrice}}</text>
      </view>
      <button class="confirm-btn" bindtap="confirmOrder">ç¡®è®¤ä¸‹å•</button>
      <text class="price-note">è´¹ç”¨åŒ…å«ï¼šæ™¯ç‚¹é—¨ç¥¨ã€å¯¼è§ˆæœåŠ¡ã€åŸºç¡€ä¿é™©</text>
    </view>
  </view>

  <!-- é®ç½©å±‚ -->
  <view class="overlay {{showPricePanel ? 'show' : ''}}" bindtap="closePricePanel" wx:if="{{showPricePanel}}"></view>
</view>
